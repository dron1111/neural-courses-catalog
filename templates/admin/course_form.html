{% extends "base.html" %}

{% block title %}{% if is_new %}Создание курса{% else %}Редактирование курса{% endif %} — Админ-панель{% endblock %}

{% block content %}
<div class="max-w-4xl mx-auto">
    <!-- Заголовок -->
    <div class="mb-8">
        <h1 class="text-3xl font-bold text-gray-900">
            {% if is_new %}
            Создание нового курса
            {% else %}
            Редактирование курса
            {% endif %}
        </h1>
    </div>

    <!-- Форма -->
    <div class="bg-white rounded-xl shadow-lg p-8">
        <form method="post">
            <!-- Скрытый токен -->
            <input type="hidden" name="token" value="{{ token }}">
            
            <!-- Поля формы -->
            <div class="space-y-6">
                <!-- Название и Slug -->
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Название курса *</label>
                        <input type="text" name="title" value="{{ course.title if course else '' }}" required 
                               class="w-full border border-gray-300 rounded-lg p-3">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Slug (URL) *</label>
                        <input type="text" name="slug" value="{{ course.slug if course else '' }}" required 
                               class="w-full border border-gray-300 rounded-lg p-3 font-mono" placeholder="python-ml-basics">
                        <p class="text-sm text-gray-500 mt-1">Только латинские буквы, цифры и дефисы</p>
                    </div>
                </div>

                <!-- Категория, Уровень, Формат -->
                <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Категория *</label>
                        <select name="category_slug" required class="w-full border border-gray-300 rounded-lg p-3">
                            <option value="">Выберите категорию</option>
                            <option value="design" {% if course and course.category_slug == 'design' %}selected{% endif %}>Design</option>
                            <option value="video" {% if course and course.category_slug == 'video' %}selected{% endif %}>Video</option>
                            <option value="marketing" {% if course and course.category_slug == 'marketing' %}selected{% endif %}>Marketing</option>
                            <option value="automation" {% if course and course.category_slug == 'automation' %}selected{% endif %}>Automation</option>
                            <option value="coding" {% if course and course.category_slug == 'coding' %}selected{% endif %}>Coding</option>
                            <option value="business" {% if course and course.category_slug == 'business' %}selected{% endif %}>Business</option>
                        </select>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Уровень *</label>
                        <select name="level" required class="w-full border border-gray-300 rounded-lg p-3">
                            <option value="">Выберите уровень</option>
                            <option value="beginner" {% if course and course.level == 'beginner' %}selected{% endif %}>Beginner</option>
                            <option value="middle" {% if course and course.level == 'middle' %}selected{% endif %}>Middle</option>
                            <option value="pro" {% if course and course.level == 'pro' %}selected{% endif %}>Pro</option>
                        </select>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Формат *</label>
                        <select name="format" required class="w-full border border-gray-300 rounded-lg p-3">
                            <option value="">Выберите формат</option>
                            <option value="online" {% if course and course.format == 'online' %}selected{% endif %}>Online</option>
                            <option value="offline" {% if course and course.format == 'offline' %}selected{% endif %}>Offline</option>
                            <option value="mixed" {% if course and course.format == 'mixed' %}selected{% endif %}>Mixed</option>
                        </select>
                    </div>
                </div>

                <!-- Цена и Длительность -->
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Цена (от) *</label>
                        <input type="number" name="price_from" value="{{ course.price_from if course else '' }}" min="0" required 
                               class="w-full border border-gray-300 rounded-lg p-3">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Длительность *</label>
                        <input type="text" name="duration" value="{{ course.duration if course else '' }}" required 
                               class="w-full border border-gray-300 rounded-lg p-3" placeholder="4 недели">
                    </div>
                </div>

                <!-- Провайдер и Ссылка -->
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Провайдер *</label>
                        <input type="text" name="provider" value="{{ course.provider if course else '' }}" required 
                               class="w-full border border-gray-300 rounded-lg p-3">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Партнерская ссылка *</label>
                        <input type="url" name="affiliate_url" value="{{ course.affiliate_url if course else '' }}" required 
                               class="w-full border border-gray-300 rounded-lg p-3" placeholder="https://...">
                    </div>
                </div>

                <!-- Теги -->
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">Теги</label>
                    <input type="text" name="tags" value="{{ course.tags if course else '' }}" 
                           class="w-full border border-gray-300 rounded-lg p-3" placeholder="python, ml, ai, data science">
                    <p class="text-sm text-gray-500 mt-1">Через запятую. По ним будет работать поиск</p>
                </div>

                <!-- Описание -->
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">Краткое описание *</label>
                    <textarea name="short_desc" rows="3" required 
                              class="w-full border border-gray-300 rounded-lg p-3">{{ course.short_desc if course else '' }}</textarea>
                </div>

                <!-- Чекбокс публикации -->
                <div class="flex items-center">
                    <input type="checkbox" id="is_published" name="is_published" value="true" 
                           {% if course and course.is_published %}checked{% endif %}
                           class="h-4 w-4 text-blue-600 border-gray-300 rounded">
                    <label for="is_published" class="ml-3 text-sm font-medium text-gray-700">
                        Опубликовать курс (сделать видимым в каталоге)
                    </label>
                </div>
            </div>

            <!-- Кнопки -->
            <div class="flex justify-between pt-8 mt-8 border-t border-gray-200">
                <a href="/admin/courses?token={{ token }}" class="px-6 py-3 border border-gray-300 rounded-lg text-gray-700 hover:bg-gray-50 font-medium">
                    ← Назад к списку
                </a>
                <button type="submit" class="bg-blue-600 text-white px-8 py-3 rounded-lg hover:bg-blue-700 font-medium">
                    {% if is_new %}
                    Создать курс
                    {% else %}
                    Сохранить изменения
                    {% endif %}
                </button>
            </div>
        </form>
    </div>
</div>
{% endblock %}
